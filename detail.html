<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kumpulan Semua Postingan</title>

<style>
:root{
  --bg:#0b0f1a;
  --card:#111827;
  --text:#f3f4f6;
  --btn:#2563eb;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial, sans-serif;
}

header{
  padding:20px;
  font-size:22px;
  font-weight:bold;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:15px;
  padding:20px;
}

.card{
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  transition:.3s;
}

.card:hover{
  transform:scale(1.05);
}

.card video,
.card img{
  width:100%;
  height:230px;
  object-fit:cover;
}

.card-title{
  padding:10px;
  font-size:14px;
}

.next-wrapper{
  text-align:center;
  padding:20px;
}

.next-btn{
  background:var(--btn);
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
}
</style>
</head>

<body>

<header>ðŸ“º Kumpulan Semua Postingan</header>

<div class="grid" id="grid"></div>

<div class="next-wrapper">
  <button class="next-btn" id="nextBtn">Next</button>
</div>

<script>
let allPosts = [];
let currentPage = 0;
const perPage = 12;

async function load(){
  try{

    const res = await fetch("/videos", { cache: "no-store" });
    const json = await res.json();

    // Support struktur object lama
    allPosts = Object.entries(json).reverse();

    render();

  }catch(e){
    document.getElementById("grid").innerHTML = "Gagal memuat data.";
  }
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  const start = currentPage * perPage;
  const end = start + perPage;

  const slice = allPosts.slice(start, end);

  if(!slice.length){
    document.getElementById("nextBtn").style.display = "none";
    return;
  }

  slice.forEach(([key, post]) => {

    const title =
      post.title ||
      post.name ||
      "No Title";

    const videoUrl =
      post.video ||
      post.url ||
      post.link ||
      "";

    const thumbnail =
      post.thumbnail ||
      post.thumb ||
      post.image ||
      null;

    const div = document.createElement("div");
    div.className = "card";

    // ðŸ”¥ Kalau ada thumbnail pakai image
    if(thumbnail){
      div.innerHTML = `
        <img src="${thumbnail}">
        <div class="card-title">${title}</div>
      `;
    } else if(videoUrl){
      // ðŸ”¥ Ambil frame depan video otomatis
      div.innerHTML = `
        <video src="${videoUrl}" preload="metadata" muted></video>
        <div class="card-title">${title}</div>
      `;
    } else {
      div.innerHTML = `
        <img src="https://via.placeholder.com/300x450?text=No+Image">
        <div class="card-title">${title}</div>
      `;
    }

    div.onclick = () => location.href = `index.html?id=${key}`;

    grid.appendChild(div);
  });
}

document.getElementById("nextBtn").onclick = () => {
  currentPage++;
  render();
};

load();
</script>

<!-- IKLAN -->
<script>
(function(s){
  s.dataset.zone='9713245';
  s.src='https://al5sm.com/tag.min.js';
})
([document.documentElement, document.body]
.filter(Boolean).pop()
.appendChild(document.createElement('script')))
</script>

</body>
</html>
