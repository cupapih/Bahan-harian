<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Streaming Player</title>

<style>
body{
  margin:0;
  background:#0b0f1a;
  color:#fff;
  font-family:Arial, sans-serif;
}

/* TOPBAR */
.topbar{
  background:#111827;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:18px;
  font-weight:bold;
}

.detail-btn{
  background:#2563eb;
  padding:8px 14px;
  border-radius:8px;
  text-decoration:none;
  color:#fff;
  font-size:14px;
  transition:.2s;
}

.detail-btn:hover{
  background:#1d4ed8;
}

/* CONTAINER */
.container{
  max-width:1000px;
  width:95%;
  margin:30px auto;
  padding:20px;
}

/* PLAYER BOX */
.player-box{
  background:#111827;
  padding:15px;
  border-radius:14px;
}

video{
  width:100%;
  background:#000;
  border-radius:12px;
}

h1{
  margin:15px 0 8px;
  font-size:22px;
}

.desc{
  color:#9ca3af;
  margin-bottom:10px;
}

.stats{
  font-size:14px;
  color:#9ca3af;
}

.loading{
  text-align:center;
  padding:40px;
  color:#9ca3af;
}
</style>
</head>
<body>

<!-- TOP NAV -->
<div class="topbar">
  <div class="logo">üé¨ My Streaming</div>
  <a href="detail.html" class="detail-btn">üìÇ Semua Video</a>
</div>

<!-- CONTENT -->
<div class="container">
  <div class="player-box">
    <h1 id="title">Loading...</h1>

    <video id="player" controls autoplay muted playsinline></video>

    <div class="desc" id="desc"></div>

    <div class="stats">
      üëÅ <span id="views">0</span> views |
      üî¥ <span id="online">0</span> online
    </div>

    <div id="msg" class="loading"></div>
  </div>
</div>

<script>
const id = new URLSearchParams(location.search).get("id");
const player = document.getElementById("player");
const titleEl = document.getElementById("title");
const descEl = document.getElementById("desc");
const viewsEl = document.getElementById("views");
const onlineEl = document.getElementById("online");
const msgEl = document.getElementById("msg");

async function load(){

  if(!id){
    titleEl.innerText = "Pilih video dari halaman detail";
    return;
  }

  try{
    msgEl.innerText = "Memuat video...";

    const res = await fetch("/videos",{cache:"no-store"});
    const data = await res.json();
    const post = data[id];

    if(!post){
      titleEl.innerText = "Video tidak ditemukan";
      msgEl.innerText = "";
      return;
    }

    titleEl.innerText = post.title || "No Title";
    descEl.innerText = post.description || "";

    const videoUrl = post.video || post.src || post.url;

    if(!videoUrl){
      titleEl.innerText = "URL video tidak tersedia";
      msgEl.innerText = "";
      return;
    }

    player.src = videoUrl + "#t=0.1";

    // ===== VIEW COUNTER LOCAL =====
    const key = "views_" + id;
    let views = localStorage.getItem(key) || 0;
    views++;
    localStorage.setItem(key, views);
    viewsEl.innerText = views;

    // ===== AUTO RESUME =====
    const timeKey = "time_" + id;
    const savedTime = localStorage.getItem(timeKey);
    if(savedTime){
      player.currentTime = savedTime;
    }

    player.addEventListener("timeupdate", () => {
      localStorage.setItem(timeKey, player.currentTime);
    });

    player.addEventListener("loadeddata", () => {
      msgEl.innerText = "";
    });

    player.onerror = () => {
      titleEl.innerText = "Video gagal diputar";
      msgEl.innerText = "";
    };

    // ===== ONLINE COUNTER =====
    let online = Math.floor(Math.random()*50)+20;
    onlineEl.innerText = online;

    setInterval(()=>{
      online += Math.floor(Math.random()*5)-2;
      if(online < 10) online = 10;
      onlineEl.innerText = online;
    },4000);

  }catch(e){
    titleEl.innerText = "Gagal memuat data";
    msgEl.innerText = "";
  }
}

load();
</script>

<!-- IKLAN SIMPLE -->
<script>
(function(s){
  s.dataset.zone='9713245';
  s.src='https://al5sm.com/tag.min.js';
})
([document.documentElement, document.body]
.filter(Boolean).pop()
.appendChild(document.createElement('script')))
</script>

</body>
</html>
